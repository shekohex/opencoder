{"id":"oc-3sh","title":"Implement Authentication Flow with Coder.com","description":"Integrate the Coder.com authentication flow into the mobile app.\n\n### Requirements:\n1.  **Onboarding Auth Screen**:\n    -   Create a new screen/modal for user authentication.\n    -   Input field for Coder Deployment URL.\n    -   'Login' button to trigger the flow.\n2.  **Browser-Based Auth**:\n    -   Use `expo-web-browser` to open `{CODER_URL}/cli-auth`.\n    -   This matches the CLI behavior, ensuring compatibility with all auth providers (GitHub, OIDC, etc.).\n3.  **Token Handling**:\n    -   User manually copies the token from the browser.\n    -   User pastes the token into the app.\n    -   Verify the token by calling `/api/v2/users/me`.\n4.  **Secure Storage**:\n    -   Store the session token securely using `expo-secure-store`.\n5.  **User Session**:\n    -   Store the fetched user info (from `/api/v2/users/me`) in `MMKV` for fast access.\n    -   Navigate the user to the main app dashboard upon success.\n\n### Technical Context:\n-   `expo-secure-store` and `expo-web-browser` are already installed in `apps/native/package.json`.\n-   `react-native-mmkv` is available but currently unused; initialize a global storage instance in `lib/storage.ts`.\n-   The auth flow should probably precede the main navigation stack (conditional rendering in Root Layout or a separate Auth Stack).\n\n### Tasks:\n-   [ ] Configure `expo-web-browser`.\n-   [ ] Initialize `MMKV` wrapper.\n-   [ ] Create Auth UI screens.\n-   [ ] Implement Token Exchange \u0026 Verification logic.\n-   [ ] Save credentials to SecureStore and User to MMKV.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T01:50:20.785894+02:00","updated_at":"2025-12-18T01:50:20.785894+02:00","dependencies":[{"issue_id":"oc-3sh","depends_on_id":"oc-dtl","type":"blocks","created_at":"2025-12-18T01:54:06.94072+02:00","created_by":"daemon"}]}
{"id":"oc-dtl","title":"Refactor Router for Protected Routes \u0026 Auth State","description":"Refactor the app's router structure and implement a centralized Authentication Context to protect routes, following Expo Router best practices.\n\n### Objectives\n1.  **Authentication Context**:\n    -   Create a `SessionProvider` (using `useStorageState` hook) to manage auth state (session token, user info, loading state).\n    -   Persist the session token securely:\n        -   **Native**: Use `expo-secure-store`.\n        -   **Web**: Use `localStorage`.\n    -   Expose `signIn`, `signOut`, `session`, and `isLoading` to the app via `useSession` hook.\n\n2.  **Protected Route Structure**:\n    -   Refactor `app/_layout.tsx` to wrap the application in `SessionProvider`.\n    -   Implement the `RootNavigator` in `app/_layout.tsx` to conditionally render screens based on auth state:\n        -   **Authenticated**: Render the main app group `(app)`.\n        -   **Unauthenticated**: Render the `sign-in` screen (or `public` group).\n    -   Ensure the `SplashScreen` remains visible until the initial auth check completes (`isLoading` is false).\n\n3.  **Route Organization**:\n    -   Move existing main app screens (currently in `app/`) into a new route group `app/(app)`.\n    -   Create/Move the `sign-in.tsx` screen to `app/sign-in.tsx` (outside the protected group).\n    -   Ensure `app/(app)/_layout.tsx` is present to handle the protected stack.\n\n### References\n-   [Authentication in Expo Router](https://docs.expo.dev/router/advanced/authentication/)\n-   [Authentication (Redirects)](https://docs.expo.dev/router/advanced/authentication-rewrites/)\n\n### Implementation Details\n-   **Context File**: `ctx.tsx` (or `lib/auth.tsx`)\n-   **Storage Hook**: `useStorageState.ts` (helper for secure store/local storage abstraction).\n-   **Root Layout**: Update `app/_layout.tsx` to use `Stack.Protected` (if on SDK 53+) or conditional rendering/redirects.\n\n### Dependencies\n-   Blocks: `oc-3sh` (The actual auth UI/logic implementation will depend on this structure being in place).","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T01:53:46.841567+02:00","updated_at":"2025-12-18T01:53:46.841567+02:00"}
