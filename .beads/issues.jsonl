{"id":"oc-3sh","title":"Implement Authentication Flow with Coder.com","description":"Integrate the Coder.com authentication flow into the mobile app.\n\n### Requirements:\n1.  **Onboarding Auth Screen**:\n    -   Create a new screen/modal for user authentication.\n    -   Input field for Coder Deployment URL.\n    -   'Login' button to trigger the flow.\n2.  **Browser-Based Auth**:\n    -   Use `expo-web-browser` to open `{CODER_URL}/cli-auth`.\n    -   This matches the CLI behavior, ensuring compatibility with all auth providers (GitHub, OIDC, etc.).\n3.  **Token Handling**:\n    -   User manually copies the token from the browser.\n    -   User pastes the token into the app.\n    -   Verify the token by calling `/api/v2/users/me`.\n4.  **Secure Storage**:\n    -   Store the session token securely using `expo-secure-store`.\n5.  **User Session**:\n    -   Store the fetched user info (from `/api/v2/users/me`) in `MMKV` for fast access.\n    -   Navigate the user to the main app dashboard upon success.\n\n### Technical Context:\n-   `expo-secure-store` and `expo-web-browser` are already installed in `apps/native/package.json`.\n-   `react-native-mmkv` is available but currently unused; initialize a global storage instance in `lib/storage.ts`.\n-   The auth flow should probably precede the main navigation stack (conditional rendering in Root Layout or a separate Auth Stack).\n\n### Tasks:\n-   [ ] Configure `expo-web-browser`.\n-   [ ] Initialize `MMKV` wrapper.\n-   [ ] Create Auth UI screens.\n-   [ ] Implement Token Exchange \u0026 Verification logic.\n-   [ ] Save credentials to SecureStore and User to MMKV.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T01:50:20.785894+02:00","updated_at":"2025-12-18T01:50:20.785894+02:00","dependencies":[{"issue_id":"oc-3sh","depends_on_id":"oc-dtl","type":"blocks","created_at":"2025-12-18T01:54:06.94072+02:00","created_by":"daemon"}]}
{"id":"oc-dtl","title":"Refactor Router for Protected Routes \u0026 Auth State","description":"Refactor the app's router structure and implement a centralized Authentication Context to protect routes, following Expo Router best practices.\n\n### Objectives\n1.  **Authentication Context**:\n    -   Create a `SessionProvider` (using `useStorageState` hook) to manage auth state (session token, user info, loading state).\n    -   Persist the session token securely:\n        -   **Native**: Use `expo-secure-store`.\n        -   **Web**: Use `localStorage`.\n    -   Expose `signIn`, `signOut`, `session`, and `isLoading` to the app via `useSession` hook.\n\n2.  **Protected Route Structure**:\n    -   Refactor `app/_layout.tsx` to wrap the application in `SessionProvider`.\n    -   Implement the `RootNavigator` in `app/_layout.tsx` to conditionally render screens based on auth state:\n        -   **Authenticated**: Render the main app group `(app)`.\n        -   **Unauthenticated**: Render the `sign-in` screen (or `public` group).\n    -   Ensure the `SplashScreen` remains visible until the initial auth check completes (`isLoading` is false).\n\n3.  **Route Organization**:\n    -   Move existing main app screens (currently in `app/`) into a new route group `app/(app)`.\n    -   Create/Move the `sign-in.tsx` screen to `app/sign-in.tsx` (outside the protected group).\n    -   Ensure `app/(app)/_layout.tsx` is present to handle the protected stack.\n\n### References\n-   [Authentication in Expo Router](https://docs.expo.dev/router/advanced/authentication/)\n-   [Authentication (Redirects)](https://docs.expo.dev/router/advanced/authentication-rewrites/)\n\n### Implementation Details\n-   **Context File**: `ctx.tsx` (or `lib/auth.tsx`)\n-   **Storage Hook**: `useStorageState.ts` (helper for secure store/local storage abstraction).\n-   **Root Layout**: Update `app/_layout.tsx` to use `Stack.Protected` (if on SDK 53+) or conditional rendering/redirects.\n\n### Dependencies\n-   Blocks: `oc-3sh` (The actual auth UI/logic implementation will depend on this structure being in place).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T01:53:46.841567+02:00","updated_at":"2025-12-18T02:14:24.579569+02:00","closed_at":"2025-12-18T02:14:24.579569+02:00","close_reason":"Completed"}
{"id":"oc-u6w","title":"Update Expo packages for compatibility","description":"Update expo, expo-linking, expo-router, and expo-splash-screen to their expected versions to resolve warnings.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-18T15:58:51.424798+02:00","updated_at":"2025-12-18T15:59:34.399621+02:00","closed_at":"2025-12-18T15:59:34.399621+02:00","close_reason":"Updated packages in apps/native/package.json and ran verification"}
{"id":"oc-uti","title":"Cross-platform Design System v1 (Uniwind + RN ARIA)","description":"Context\n- Single Expo codebase targets iOS, Android, and web (react-native-web) with one shared UI system.\n- Styling should be Uniwind (Tailwind v4), and component behavior should be RN-focused ARIA hooks.\n- We will port OpenCode UI tokens and component patterns into a new headless UI layer in apps/native.\n\nScope\n- Build a headless primitives layer in apps/native and style with Uniwind.\n- Primitives v1: Button, TextField, Dialog, Select, Tabs, Switch.\n- Full keyboard navigation on web for Dialog, Select, Tabs, and app-level hotkeys.\n\nOut of scope\n- Desktop app UI (Solid/Kobalte) or direct import of OpenCode UI.\n- Non-Expo web app (DOM-only) or separate codebase.\n\nDependencies\n- Uniwind + Tailwind v4 for styling.\n- RN-focused ARIA hooks for behavior and accessibility.\n\nReferences (OpenCode design source)\n- /tmp/opencode/packages/ui/src/styles/index.css:1\n- /tmp/opencode/packages/ui/src/styles/colors.css:1\n- /tmp/opencode/packages/ui/src/styles/theme.css:1\n- /tmp/opencode/packages/ui/src/components/button.tsx:1\n- /tmp/opencode/packages/ui/src/components/text-field.tsx:1\n- /tmp/opencode/packages/ui/src/components/dialog.tsx:1\n- /tmp/opencode/packages/ui/src/components/select.tsx:1\n- /tmp/opencode/packages/ui/src/components/tabs.tsx:1\n- /tmp/opencode/packages/ui/src/components/switch.tsx:1\n\nLocal app context\n- apps/native/metro.config.js:1\n- apps/native/app/_layout.tsx:1\n- apps/native/lib/constants.ts:1","design":"Design approach\n- Port OpenCode tokens (colors, radii, typography, spacing, shadows) into TS tokens and map into Tailwind config via Uniwind.\n- Build headless primitives (behavior + a11y) and keep styling in Uniwind class recipes.\n- Use RN-focused ARIA hooks for overlay/focus/listbox patterns and provide a web keyboard-first experience.\n\nExternal sources\n- https://docs.uniwind.dev/quickstart.md\n- https://reactnative.dev/docs/accessibility\n- https://docs.expo.dev/guides/customizing-metro/\n- https://github.com/gluestack/react-native-aria","acceptance_criteria":"- Uniwind configured in apps/native and works on iOS/Android/web with className support.\n- OpenCode tokens are ported into TS and mapped into Tailwind theme.\n- Primitives v1 exist and are used in a demo screen with keyboard navigation on web.\n- Dialog/Select/Tabs pass keyboard navigation acceptance checks on web and accessibility props on native.\n- App-level keybindings are supported without interfering with TextInput focus.","status":"open","priority":1,"issue_type":"epic","created_at":"2025-12-18T14:16:39.496053+02:00","updated_at":"2025-12-18T14:16:39.496053+02:00","labels":["a11y","design-system","expo","react-native","react-native-web","ui","uniwind"]}
{"id":"oc-uti.1","title":"Uniwind baseline wiring in apps/native","description":"Add Uniwind + Tailwind v4 baseline wiring for Expo + web.\n\nSteps\n- Add global.css at apps/native/global.css with @import 'tailwindcss' and @import 'uniwind'.\n- Wrap Metro config using withUniwindConfig and point cssEntryFile to ./global.css.\n- Import global.css in apps/native/app/_layout.tsx (not root index) to preserve fast refresh.\n- Ensure uniwind-types.d.ts is generated under apps/native and picked up by TS.\n\nReferences\n- apps/native/metro.config.js:1\n- apps/native/app/_layout.tsx:1\n- https://docs.uniwind.dev/quickstart.md\n- https://docs.expo.dev/guides/customizing-metro/","acceptance_criteria":"- className utilities work across iOS/Android/web.\n- Metro config uses withUniwindConfig as outermost wrapper.\n- global.css is imported from app/_layout.tsx.\n- Uniwind typings are generated and TS recognizes className.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T14:19:43.807234+02:00","updated_at":"2025-12-19T14:56:41.480799+02:00","closed_at":"2025-12-19T14:56:41.480799+02:00","close_reason":"Implemented Uniwind baseline wiring: added global.css, wrapped metro.config.js with withUniwindConfig, imported CSS from app/_layout.tsx, verified TypeScript typings generated correctly","labels":["expo","react-native-web","tailwind","uniwind"],"dependencies":[{"issue_id":"oc-uti.1","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:43.810315+02:00","created_by":"daemon"}]}
{"id":"oc-uti.2","title":"Port OpenCode tokens into TS + Tailwind theme","description":"Port OpenCode UI tokens into a TS token source and map into Tailwind theme for Uniwwind.\n\nSteps\n- Convert OpenCode CSS variables (colors, radii, spacing, typography, shadows) into TS token objects.\n- Map tokens into Tailwind theme config and ensure light/dark variants are available.\n- Add a simple token preview screen in the app to validate colors/typography.\n\nReferences (OpenCode)\n- /tmp/opencode/packages/ui/src/styles/colors.css:1\n- /tmp/opencode/packages/ui/src/styles/theme.css:1\n- /tmp/opencode/packages/ui/src/styles/index.css:1","acceptance_criteria":"- Tokens exist as TS source of truth and drive Tailwind theme values.\n- Light/dark tokens are mapped and can be switched at runtime.\n- Token preview screen shows primary surfaces, text, borders, and radius styles.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T14:19:43.949039+02:00","updated_at":"2025-12-19T15:04:03.52624+02:00","closed_at":"2025-12-19T15:04:03.52624+02:00","close_reason":"Completed: TS tokens created, Tailwind theme mapped, light/dark variants via @layer theme + @variant, token preview screen added","labels":["design-system","tailwind","tokens"],"dependencies":[{"issue_id":"oc-uti.2","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:43.949667+02:00","created_by":"daemon"}]}
{"id":"oc-uti.3","title":"Bridge NAV_THEME to new tokens","description":"Align React Navigation theme with new token values so navigation UI matches the design system.\n\nSteps\n- Update apps/native/lib/constants.ts to reference the new token palette instead of hardcoded HSL.\n- Ensure ThemeProvider in apps/native/app/_layout.tsx uses updated NAV_THEME values.\n- Validate navigation colors in light/dark across iOS/Android/web.\n\nReferences\n- apps/native/lib/constants.ts:1\n- apps/native/app/_layout.tsx:1","acceptance_criteria":"- NAV_THEME pulls from the design system tokens.\n- Light/dark navigation colors match token palette on all platforms.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-18T14:19:44.092484+02:00","updated_at":"2025-12-19T19:22:16.582716+02:00","closed_at":"2025-12-19T19:22:16.582716+02:00","close_reason":"Completed","labels":["react-navigation","theme"],"dependencies":[{"issue_id":"oc-uti.3","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:44.093214+02:00","created_by":"daemon"}]}
{"id":"oc-uti.4","title":"A11y foundation + ARIA hook dependencies","description":"Add and standardize RN-focused ARIA hook dependencies and cross-platform focus behavior.\n\nSteps\n- Add @react-native-aria packages required for focus, overlays, and listbox patterns.\n- Implement a shared focus-ring class recipe for web and focus-visible behavior.\n- Provide wrapper exports for ARIA hooks to centralize versions and usage.\n- Add a11y checklist for Dialog/Select/Tabs keyboard navigation.\n\nExternal sources\n- https://reactnative.dev/docs/accessibility\n- https://github.com/gluestack/react-native-aria","acceptance_criteria":"- ARIA hook packages are installed and wrapped by a local module.\n- Focus ring is visible and consistent on web.\n- Keyboard navigation checklist is documented for complex primitives.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T14:19:44.229728+02:00","updated_at":"2025-12-19T19:43:46.866469+02:00","closed_at":"2025-12-19T19:43:46.866469+02:00","close_reason":"Installed dependencies, added focus-ring utility, created a11y lib, and added checklist.","labels":["a11y","aria","foundation"],"dependencies":[{"issue_id":"oc-uti.4","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:44.230318+02:00","created_by":"daemon"}]}
{"id":"oc-uti.5","title":"Headless primitives v1: Button, TextField, Switch","description":"Implement core headless primitives and align their APIs to OpenCode UI patterns.\n\nSteps\n- Button: size/variant, optional icon slot, pressed/disabled states, focus-visible styling.\n- TextField: label/description/error, multiline option, copyable behavior (web-only if needed).\n- Switch: label/description, checked/disabled states, a11y roles.\n- Expose slot props and className hooks for styling via Uniwind.\n\nReferences (OpenCode)\n- /tmp/opencode/packages/ui/src/components/button.tsx:1\n- /tmp/opencode/packages/ui/src/components/text-field.tsx:1\n- /tmp/opencode/packages/ui/src/components/switch.tsx:1","acceptance_criteria":"- Button, TextField, Switch primitives exist and are used in a demo screen.\n- Disabled/pressed/focus states render correctly on all platforms.\n- Accessibility roles/labels are applied and keyboard activation works on web.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-18T14:19:44.367456+02:00","updated_at":"2025-12-19T19:53:37.020071+02:00","closed_at":"2025-12-19T19:53:37.020071+02:00","close_reason":"Implemented Button, TextField, and Switch primitives and added demo screen.","labels":["primitives","ui"],"dependencies":[{"issue_id":"oc-uti.5","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:44.368592+02:00","created_by":"daemon"}]}
{"id":"oc-uti.6","title":"Dialog primitive (overlay + focus trap)","description":"Implement Dialog with overlay, focus management, and keyboard support on web.\n\nSteps\n- Build Dialog structure with header/body/close action slots.\n- Use ARIA overlays + focus management to trap focus and restore on close.\n- Support ESC close and backdrop click as configured.\n- Ensure screen readers announce title/description.\n\nReferences (OpenCode)\n- /tmp/opencode/packages/ui/src/components/dialog.tsx:1","acceptance_criteria":"- Focus is trapped inside dialog on web and restored to trigger on close.\n- ESC closes dialog and backdrop click works as expected.\n- Screen reader announces title/description correctly.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T14:19:44.561288+02:00","updated_at":"2025-12-18T14:19:44.561288+02:00","labels":["a11y","dialog","overlay"],"dependencies":[{"issue_id":"oc-uti.6","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:44.561877+02:00","created_by":"daemon"}]}
{"id":"oc-uti.7","title":"Select primitive (listbox + overlay)","description":"Implement Select using listbox + overlay patterns with robust keyboard navigation.\n\nSteps\n- Build trigger, popover, listbox, and option rendering slots.\n- Support arrow key navigation, typeahead, enter/escape behavior on web.\n- Handle option grouping and custom labels.\n- Provide className hooks for trigger/content/option styles.\n\nReferences (OpenCode)\n- /tmp/opencode/packages/ui/src/components/select.tsx:1","acceptance_criteria":"- Keyboard navigation works on web (arrows/typeahead/enter/escape).\n- Selected value is announced to screen readers and visually reflected.\n- Works on iOS/Android with touch selection.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T14:19:44.701522+02:00","updated_at":"2025-12-18T14:19:44.701522+02:00","labels":["a11y","listbox","select"],"dependencies":[{"issue_id":"oc-uti.7","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:44.702061+02:00","created_by":"daemon"}]}
{"id":"oc-uti.8","title":"Tabs primitive (roving focus)","description":"Implement Tabs with roving focus and accessible roles.\n\nSteps\n- Build Tabs root, list, trigger, and content slots.\n- Implement roving focus and arrow key navigation on web.\n- Provide className hooks for selected/hover/focus states.\n\nReferences (OpenCode)\n- /tmp/opencode/packages/ui/src/components/tabs.tsx:1","acceptance_criteria":"- Left/right arrow keys move focus between tabs on web.\n- Selected tab is announced by screen readers.\n- Content updates correctly for selected tab.","status":"open","priority":1,"issue_type":"task","created_at":"2025-12-18T14:19:44.839232+02:00","updated_at":"2025-12-18T14:19:44.839232+02:00","labels":["a11y","roving-focus","tabs"],"dependencies":[{"issue_id":"oc-uti.8","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:44.839747+02:00","created_by":"daemon"}]}
{"id":"oc-uti.9","title":"Keybindings layer for web","description":"Add a scoped keybindings layer that works on web without interfering with TextInput.\n\nSteps\n- Implement a useHotkeys hook (web-only) with scope control.\n- Add safe defaults to avoid capturing input when focus is in TextInput/textarea.\n- Support app-level shortcuts (e.g., Cmd+K, Esc) with override options.\n\nExternal sources\n- https://reactnative.dev/docs/accessibility","acceptance_criteria":"- Keybindings work on web and do not fire while typing in inputs.\n- Shortcuts are configurable per screen/scope.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-18T14:19:44.978676+02:00","updated_at":"2025-12-18T14:19:44.978676+02:00","labels":["keybindings","web"],"dependencies":[{"issue_id":"oc-uti.9","depends_on_id":"oc-uti","type":"parent-child","created_at":"2025-12-18T14:19:44.97915+02:00","created_by":"daemon"}]}
